"use strict";(globalThis.webpackChunktickerq_docs=globalThis.webpackChunktickerq_docs||[]).push([[961],{8346:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>a,contentTitle:()=>i,default:()=>h,frontMatter:()=>c,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"cron-jobs","title":"Cron Jobs","description":"Cron jobs are scheduled background tasks that run at specified intervals using cron expressions.","source":"@site/docs/cron-jobs.md","sourceDirName":".","slug":"/cron-jobs","permalink":"/docs/cron-jobs","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/cron-jobs.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Configuration","permalink":"/docs/configuration"},"next":{"title":"Time Jobs","permalink":"/docs/time-jobs"}}');var s=n(4848),o=n(8453);const c={},i="Cron Jobs",a={},d=[{value:"TickerFunction Attribute",id:"tickerfunction-attribute",level:2},{value:"Example: Auto-Reject Stale Requests",id:"example-auto-reject-stale-requests",level:2},{value:"Example: Report Generation",id:"example-report-generation",level:2},{value:"Cron Expression Syntax",id:"cron-expression-syntax",level:2},{value:"Common Patterns",id:"common-patterns",level:3},{value:"Primary Constructor Pattern",id:"primary-constructor-pattern",level:2},{value:"TickerFunctionContext",id:"tickerfunctioncontext",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"Service Registration",id:"service-registration",level:2},{value:"Next Steps",id:"next-steps",level:2}];function l(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.header,{children:(0,s.jsx)(r.h1,{id:"cron-jobs",children:"Cron Jobs"})}),"\n",(0,s.jsx)(r.p,{children:"Cron jobs are scheduled background tasks that run at specified intervals using cron expressions."}),"\n",(0,s.jsx)(r.h2,{id:"tickerfunction-attribute",children:"TickerFunction Attribute"}),"\n",(0,s.jsxs)(r.p,{children:["Use the ",(0,s.jsx)(r.code,{children:"[TickerFunction]"})," attribute to mark methods as scheduled jobs:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:'[TickerFunction("JobName", "cron-expression")]\r\npublic async Task YourJobMethod(CancellationToken cancellationToken)\r\n{\r\n    // Your job logic here\r\n}\n'})}),"\n",(0,s.jsx)(r.h2,{id:"example-auto-reject-stale-requests",children:"Example: Auto-Reject Stale Requests"}),"\n",(0,s.jsx)(r.p,{children:"Here's a real example from our demo that auto-rejects approved requests after 3 minutes:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:'public class BackgroundJobs(IRepository<RequestEntity> _requestRepository, IRepository<RequestLog> _logRepository, IRepository<Report> _reportRepository, ILogger<RequestEntity> logger)\r\n{\r\n    [TickerFunction("AutoReject", "*/30 * * * *")]\r\n    public async Task RejectStaleApprovedRequests(CancellationToken cancellationToken)\r\n    {\r\n        // Get all approved requests that are older than 3 minutes\r\n        var threeMinutesAgo = DateTime.UtcNow.AddMinutes(-3);\r\n        var staleApprovedRequests = await _requestRepository.GetAllAsync(r =>\r\n            r.Status == RequestStatus.Approved &&\r\n            r.ApprovedAt.HasValue &&\r\n            r.ApprovedAt.Value < threeMinutesAgo);\r\n        \r\n        Console.WriteLine("The Background Job is running //////////////////////////////////////");\r\n        \r\n        foreach (var request in staleApprovedRequests)\r\n        {\r\n            try\r\n            {\r\n                await UpdateRequestStatus(request.Id, RequestStatus.Rejected, \r\n                    "Auto-rejected: Approved for more than 3 minutes without completion");\r\n            }\r\n            catch (Exception ex)\r\n            {\r\n                await LogError(request.Id, $"Error rejecting stale request: {ex.Message}");\r\n            }\r\n        }\r\n    }\r\n}\n'})}),"\n",(0,s.jsx)(r.h2,{id:"example-report-generation",children:"Example: Report Generation"}),"\n",(0,s.jsx)(r.p,{children:"Another example that creates reports:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:'[TickerFunction("CreateReport")]\r\npublic async Task CreateReport(TickerFunctionContext tickerContext, CancellationToken cancellationToken)\r\n{\r\n    var report = new Report\r\n    {\r\n        Title = $"Scheduled Report - {DateTime.UtcNow:yyyy-MM-dd HH:mm}",\r\n        Content = $"This is an automatically generated report created at {DateTime.UtcNow:yyyy-MM-dd HH:mm:ss}",\r\n        CreatedAt = DateTime.UtcNow\r\n    };\r\n\r\n    await _reportRepository.AddAsync(report);\r\n    await _reportRepository.SaveAsync();\r\n    logger.LogInformation($"Report created with ID: {report.Id}");\r\n}\n'})}),"\n",(0,s.jsx)(r.h2,{id:"cron-expression-syntax",children:"Cron Expression Syntax"}),"\n",(0,s.jsx)(r.p,{children:"TickerQ uses standard cron expressions:"}),"\n",(0,s.jsxs)(r.table,{children:[(0,s.jsx)(r.thead,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.th,{children:"Field"}),(0,s.jsx)(r.th,{children:"Values"}),(0,s.jsx)(r.th,{children:"Special Characters"})]})}),(0,s.jsxs)(r.tbody,{children:[(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"Minute"}),(0,s.jsx)(r.td,{children:"0-59"}),(0,s.jsxs)(r.td,{children:[(0,s.jsx)(r.code,{children:"*"})," ",(0,s.jsx)(r.code,{children:","})," ",(0,s.jsx)(r.code,{children:"-"})," ",(0,s.jsx)(r.code,{children:"/"})]})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"Hour"}),(0,s.jsx)(r.td,{children:"0-23"}),(0,s.jsxs)(r.td,{children:[(0,s.jsx)(r.code,{children:"*"})," ",(0,s.jsx)(r.code,{children:","})," ",(0,s.jsx)(r.code,{children:"-"})," ",(0,s.jsx)(r.code,{children:"/"})]})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"Day"}),(0,s.jsx)(r.td,{children:"1-31"}),(0,s.jsxs)(r.td,{children:[(0,s.jsx)(r.code,{children:"*"})," ",(0,s.jsx)(r.code,{children:","})," ",(0,s.jsx)(r.code,{children:"-"})," ",(0,s.jsx)(r.code,{children:"/"})," ",(0,s.jsx)(r.code,{children:"?"})," ",(0,s.jsx)(r.code,{children:"L"})," ",(0,s.jsx)(r.code,{children:"W"})]})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"Month"}),(0,s.jsx)(r.td,{children:"1-12"}),(0,s.jsxs)(r.td,{children:[(0,s.jsx)(r.code,{children:"*"})," ",(0,s.jsx)(r.code,{children:","})," ",(0,s.jsx)(r.code,{children:"-"})," ",(0,s.jsx)(r.code,{children:"/"})]})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"Day of Week"}),(0,s.jsx)(r.td,{children:"0-7"}),(0,s.jsxs)(r.td,{children:[(0,s.jsx)(r.code,{children:"*"})," ",(0,s.jsx)(r.code,{children:","})," ",(0,s.jsx)(r.code,{children:"-"})," ",(0,s.jsx)(r.code,{children:"/"})," ",(0,s.jsx)(r.code,{children:"?"})," ",(0,s.jsx)(r.code,{children:"L"})," ",(0,s.jsx)(r.code,{children:"#"})]})]})]})]}),"\n",(0,s.jsx)(r.h3,{id:"common-patterns",children:"Common Patterns"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:'"*/30 * * * *"     // Every 30 seconds\r\n"0 * * * *"        // Every hour\r\n"0 0 * * *"        // Daily at midnight\r\n"0 0 * * 1"        // Weekly on Monday\r\n"0 0 1 * *"        // Monthly on the 1st\r\n"0 9-17 * * 1-5"   // Every hour from 9 AM to 5 PM, Monday to Friday\n'})}),"\n",(0,s.jsx)(r.h2,{id:"primary-constructor-pattern",children:"Primary Constructor Pattern"}),"\n",(0,s.jsx)(r.p,{children:"Use primary constructors for dependency injection:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:"public class BackgroundJobs(\r\n    IRepository<RequestEntity> _requestRepository, \r\n    IRepository<RequestLog> _logRepository, \r\n    IRepository<Report> _reportRepository, \r\n    ILogger<RequestEntity> logger)\r\n{\r\n    // Your job methods here\r\n}\n"})}),"\n",(0,s.jsx)(r.h2,{id:"tickerfunctioncontext",children:"TickerFunctionContext"}),"\n",(0,s.jsx)(r.p,{children:"For jobs that need access to context data:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:'[TickerFunction("JobWithData", "*/1 * * * *")]\r\npublic async Task ProcessData(TickerFunctionContext<MyDataType> context, CancellationToken cancellationToken)\r\n{\r\n    var data = context.Request; // Access your typed data\r\n    // Process the data\r\n}\n'})}),"\n",(0,s.jsx)(r.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsxs)(r.ol,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Use meaningful job names"})," that describe what the job does"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Handle exceptions"})," within your job methods"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Use CancellationToken"})," for cancellation support"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Log job execution"})," for monitoring and debugging"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Keep jobs lightweight"})," - avoid long-running operations"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Use dependency injection"})," for accessing services"]}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"service-registration",children:"Service Registration"}),"\n",(0,s.jsxs)(r.p,{children:["Register your job classes in ",(0,s.jsx)(r.code,{children:"Program.cs"}),":"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:"builder.Services.AddScoped<BackgroundJobs>();\n"})}),"\n",(0,s.jsx)(r.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,s.jsxs)(r.p,{children:["Learn about ",(0,s.jsx)(r.a,{href:"/docs/time-jobs",children:"Time Jobs"})," for one-time scheduled tasks."]})]})}function h(e={}){const{wrapper:r}={...(0,o.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>c,x:()=>i});var t=n(6540);const s={},o=t.createContext(s);function c(e){const r=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function i(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),t.createElement(o.Provider,{value:r},e.children)}}}]);